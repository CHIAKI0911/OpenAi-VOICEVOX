<!-- --デザイン構築--テキストボックスの横に削除ボタンを追加 -->

<h1>メニュー考案AI</h1>

<!DOCTYPE html>
<html lang="en">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="C:\Users\kikot\OneDrive\Documents\python\static\css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .input-container {
            display: flex;
            align-items: center;
        }
        .text-input {
            flex: 1;
        }
    </style>
    <title>選択画面</title>
</head>
<body>
    <div class="container">
        <form method="post" id="myList">
            <input id="A" type="checkbox" name="code2" value="鶏肉" hidden>
            <label for="A">鶏肉</label>
            <br>
            <input id="B" type="checkbox" name="code2" value="豚肉" hidden>
            <label for="B">豚肉</label>
            <br>
            <input id="C" type="checkbox" name="code2" value="牛肉" hidden>
            <label for="C">牛肉</label>
            <br>
            <div class="input-container">
                <input type="text" name="customInput" placeholder="その他" id="new" class="text-input">
                <button type="button" class="remove-button" onclick="removeInput(this)">削除</button>
            </div>
            <button type="button" id="addButton">追加</button>
            <button type="button" id="display">表示</button>
        </form>

        <div id="selectedItems"></div>

        <!-- <form method="post" action="submit" id="userInputForm"> -->
        <form id="userInputForm">
            <button id="submitBtn" type="button" onclick="executeAI()">実行</button>
        </form>
    </div>

    <div id="responseContainer">
        <div id="chatContainer">
            <img src="{{ url_for('static', filename='images/sikokumetan.png') }}">
            <div id="chatHistory"></div>
        </div>
        <audio id="audioPlayer" controls></audio>
        <a href="https://github.com/Hiroshiba/voicevox" target="_blank"><br>VOICEVOX:四国めたん<br>立ち絵：坂本アヒル 様</a>
    </div>



    <script>
        const form = document.getElementById("myList");
        const selectedItemsDisplay = document.getElementById("selectedItems");
        const addButton = document.getElementById("addButton");
        const displayButton = document.getElementById("display");

        addButton.addEventListener("click", function() {
            const customInput = document.getElementById("new");
            const newCustomInput = document.createElement("div");
            newCustomInput.classList.add("input-container");
            const input = document.createElement("input");
            input.type = "text";
            input.name = "customInput";
            input.placeholder = "その他";
            input.classList.add("text-input");
            const removeButton = document.createElement("button");
            removeButton.type = "button";
            removeButton.classList.add("remove-button");
            removeButton.textContent = "削除";
            removeButton.onclick = function() {
                removeInput(this);
            };

            newCustomInput.appendChild(input);
            newCustomInput.appendChild(removeButton);

            form.insertBefore(newCustomInput, addButton);
        });

        displayButton.addEventListener("click", function() {
            const selectedItems = [];

            console.log(selectedItems);
            const checkboxes = form.querySelectorAll('input[type="checkbox"]:checked');
            const customInputs = form.querySelectorAll('input[type="text"]');

            checkboxes.forEach(function(checkbox) {
                selectedItems.push(checkbox.value);
            });

            customInputs.forEach(function(input) {
                if (input.value && input.value.trim() !== "") {
                    selectedItems.push(input.value);
                    input.style.backgroundColor = "#your-color-here";
                }
            });



            console.log(selectedItems);



            selectedItemsDisplay.textContent = "選択されたアイテム: " + selectedItems.join(" , ");
        });

        function removeInput(button) {
            const inputContainer = button.parentElement;
            inputContainer.remove();
        }

        var conversation = [];

        function executeAI() {
    $.post({
        url: '/',
        data: JSON.stringify(selectedItems), // 適切なデータ形式で渡す
        contentType: 'application/json', // コンテンツタイプを設定
        success: function (response) {
            conversation.push({ answer: response.response });
            displayConversation();

            var audioPlayer = $('#audioPlayer')[0];
            audioPlayer.src = response.audio_file;
            audioPlayer.load();

            audioPlayer.addEventListener('canplaythrough', function () {
                audioPlayer.play();
            }, { once: true });

            playAudioByUrl('/audio/audio.wav');
        },
        error: function (error) {
            console.log(error);
        }
    });
}




        function displayConversation() {
            var chatHistory = $('#chatHistory');
            chatHistory.empty();

            for (var i = 0; i < conversation.length; i++) {
                var answer = conversation[i].answer;

                var answerBubble = $('<div class="chatBubble"></div>');
                var answerText = $('<p></p>').text(answer);
                answerBubble.append(answerText);

                chatHistory.append(answerBubble);
            }
        }

        function playAudioByUrl(url) {
            var audio = new Audio(url);
            audio.play();
        }

        console.log();

    </script>
</body>
</html>